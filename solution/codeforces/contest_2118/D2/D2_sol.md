# D2. Red Light, Green Light (Hard version)

## 题意

有长度为 $10^{15}$ 的排成一行的格子和常数 $k$ ，
有 $n$ 个格子里有红绿灯，每个红绿灯有初始值 $d_i < k$

* 在 $l \cdot k + d_i$ 时刻，亮红灯
* 其他时候亮绿灯

在时刻 $0$ ，你的初始位置在某些格子里，面向正方向。
每一秒，按照以下顺序

* 如果当前位置有红绿灯，并且是红色，则掉头
* 向面向的方向前进一格

有 $q$ 次询问，判断最后是否能走出这一行格子。

## 思路

如果遇到红灯，则这个红灯遇到的下一个红灯是固定的。

如果在 $p_0$ 处遇到红灯，然后转向正方向，
下一个遇到的红灯 $p_1$
满足 $p_1 - d_1 \equiv p_0 - d_0 \pmod k$

如果转向负方向，则下一个遇到的红灯 $p_1$
满足 $p_1 + d_1 \equiv p_0 + d_0 \pmod k$

用 `map` 记录余数，对于每个红灯找到左边和右边的下一个红灯。
然后用 `dfs` 找到环，遇到环内的红灯就无法走出。

对于每次询问，二分找到下一个遇到的红灯。判断能否走出。

